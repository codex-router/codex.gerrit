# Codex Chat 快速上手

## 🚀 打开聊天面板

1. 打开任意 Gerrit 变更页面。
2. 滚动到页面底部。
3. 找到 **Codex Chat** 面板。

## 🎛️ 选择下拉框

- **智能体（Agent）**：
	- 默认选择返回列表中的第一项。
	- 若加载失败，回退为 `codex`。
- **模型（Model）**：
	- 默认选择返回列表中的第一项。
	- 所选模型会通过 `--model` 传给后端。
- **Codespaces -> Open in Browser**：
	- 当前为即将推出（coming soon）。

## ⌨️ 提示词命令

- 输入提示词后按 `Enter` 发送。
- 按 `Ctrl+Enter` 在输入框中换行。
- 按 `Up` 从历史中加载上一条提示词。
- 按 `Down` 切换到更新的提示词历史。
- 输入 `@` 打开补丁集文件提及建议。
- 输入 `@all` 可将当前补丁集全部文件作为上下文。
- 输入 `#` 可打开所有可用命令建议（建议项会保留 `#` 前缀）。
- 输入 `#insight` 可触发 insight 生成，并以 Markdown 弹窗展示结果。
- `#insight` 可选参数：
	- `--repo <path>`：指定 insight 的仓库路径。
	- `--out <path>`：指定生成文件输出目录。
	- `--dry-run`：以 dry-run 模式执行 insight。

## 🔘 按钮与操作

- **Help**：
	- 位于聊天面板头部右侧。
	- 点击后打开快速上手弹窗。
	- 支持在 `English` 与 `中文` 之间切换语言。
- **📎 Attach**：
	- 添加本地文件作为额外上下文。
	- 文件会以可移除标签显示在输入框上方。
	- 文件会随下一次请求发送，并在发送后自动清空。
	- 浏览器侧单文件大小限制为 512 KB。
- **Stop Chat**：
	- 中断当前正在执行的聊天会话（session）。
- **Clear**：
	- 清空消息、输入内容与待审阅（pending review）状态。

## 📎 上传文件的上下文

- 补丁集文件**不会**自动包含。
- 仅显式 `@` 提及的文件会作为补丁集上下文发送。
- `@all` 会将当前补丁集全部文件作为上下文发送。
- 被提及文件会在服务端按当前补丁集文件进行校验。
- 被提及文件会携带当前修订版本（revision）内容发送给智能体（Agent）。

## 🔍 审阅弹窗行为

- 当响应包含统一 diff（unified diff）内容时，会打开审阅弹窗。
- 可对每个文件分别执行 **Keep** 或 **Undo**。
- 若 diff 缺少文件头，仍可基于 `@` 文件上下文进行回退（fallback）映射。
- 若仅提及一个 `@` 文件且回复只有代码块，可合成统一 diff（unified diff）预览。

## 📊 Insight 弹窗行为

- 执行成功后，生成的 Markdown 内容会在弹窗中展示。
- 若返回多个 Markdown 文件，会合并为多个分节并在同一弹窗展示。
- 若未提供 `--repo`，面板会弹出对话框要求输入 repo 路径。
