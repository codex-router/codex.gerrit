# Codex Chat 快速上手

## 🚀 打开聊天面板

1. 打开任意 Gerrit 变更页面。
2. 滚动到页面底部。
3. 找到 **Codex Chat** 面板。

## 🎛️ 选择下拉框

- **智能体（Agent）**：
	- 默认选择返回列表中的第一项。
	- 若加载失败，回退为 `codex`。
- **模型（Model）**：
	- 默认选择返回列表中的第一项。
	- 所选模型会通过 `--model` 传给后端。
- **Codespaces -> Open in Browser**：
	- 当前为即将推出（coming soon）。

## ⌨️ 提示词命令

- 输入提示词后按 `Enter` 发送。
- 按 `Ctrl+Enter` 在输入框中换行。
- 按 `Up` 从历史中加载上一条提示词。
- 按 `Down` 切换到更新的提示词历史。
- 输入 `@` 打开补丁集文件提及建议。
- 输入 `@all` 可将当前补丁集全部文件作为上下文。
- 输入 `#` 可打开所有可用命令建议（建议项会保留 `#` 前缀）。
- 输入 `#insight` 可触发 insight 生成，并以 Markdown 弹窗展示结果。
- 输入 `#graph` 可基于所选文件触发代码图谱生成。
- `#insight` 可选参数：
	- `--repo <path>`：指定 insight 的仓库路径。
	- `--out <path>`：指定生成文件输出目录。
	- `--dry-run`：以 dry-run 模式执行 insight。
- `#graph` 可选参数：
	- `--framework <name>`（或 `--framework-hint <name>`）：向图谱分析透传框架提示。
	- `--file`（或 `--files`）：选择一个或多个文件作为图谱输入。

## 🔘 按钮与操作

- **Help**：
	- 位于聊天面板头部右侧。
	- 点击后打开快速上手弹窗。
	- 支持在 `English` 与 `中文` 之间切换语言。
- **📎 Attach**：
	- 添加本地文件作为额外上下文。
	- 文件会以可移除标签显示在输入框上方。
	- 文件会随下一次请求发送，并在发送后自动清空。
	- 浏览器侧单文件大小限制为 512 KB。
- **Stop Chat**：
	- 中断当前正在执行的聊天会话（session）。
- **Clear**：
	- 清空消息、输入内容与待审阅（pending review）状态。

## 🚦 队列状态指示

- 选择器区域会显示聊天请求的队列状态卡片。
- `Queue: idle` 表示当前没有排队请求。
- `Queue: request active` 表示请求已被服务端接收并正在执行。
- `Queue: waiting for slot` 表示后端容量繁忙，请求正在等待可用执行槽位。
- `Queue: full` 表示服务端队列已满；请稍后重试。
- `Queue: wait timeout` 表示排队等待超时；请稍后重试。
- 发生队列背压时，聊天失败消息中可能会包含服务端 `503` 返回的队列详情。

## 📎 上传文件的上下文

- 补丁集文件**不会**自动包含。
- 仅显式 `@` 提及的文件会作为补丁集上下文发送。
- `@all` 会将当前补丁集全部文件作为上下文发送。
- 被提及文件会在服务端按当前补丁集文件进行校验。
- 被提及文件会携带当前修订版本（revision）内容发送给智能体（Agent）。

## 🔍 审阅弹窗行为

- 当响应包含统一 diff（unified diff）内容时，会打开审阅弹窗。
- 可对每个文件分别执行 **Keep** 或 **Undo**。
- 若 diff 缺少文件头，仍可基于 `@` 文件上下文进行回退（fallback）映射。
- 若仅提及一个 `@` 文件且回复只有代码块，可合成统一 diff（unified diff）预览。

## 📊 Insight 弹窗行为

- 执行成功后，生成的 Markdown 内容会在弹窗中展示。
- 若返回多个 Markdown 文件，会在弹窗中按文件分标签页展示。
- 可切换标签页查看每个生成文件，并可下载当前激活标签页对应文件。
- 若未提供 `--repo`，面板会弹出对话框要求输入 repo 路径。

## 🕸️ Graph 弹窗行为

- `#graph` 执行成功后，会使用同样风格的弹窗展示图谱结果文件。
- `#graph` 使用文件选择弹窗，仅支持选择一个或多个文件。
- 弹窗包含多个标签页（例如摘要与响应载荷）。
- 可切换标签页查看详情，并下载当前激活标签页对应的图谱结果文件。
- 对于图谱载荷标签页（例如 `Graph-Response.md`），工具栏会显示 `Visualize` 按钮。
- 点击 `Visualize` 可将图谱 JSON 渲染为节点-连线图，并展示 workflow / LLM 摘要信息。
- 再次点击同一按钮（显示为 `Markdown`）可切回原始 Markdown 载荷视图。
